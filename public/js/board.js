// Generated by CoffeeScript 1.5.0
(function() {
  var Board, t;

  t = THREE;

  Board = (function() {

    function Board(id, width, height, position, yaw, pitch) {
      var aspectRatio, axis;
      this.id = id;
      this.width = width;
      this.height = height;
      this.geometry = new t.PlaneGeometry(this.width, this.height);
      this.material = new t.MeshLambertMaterial({
        color: "#FFFFFF"
      });
      this.mesh = new t.Mesh(this.geometry, this.material);
      axis = new t.Vector3(Math.cos(yaw), 0, -Math.sin(yaw));
      this.mesh.rotateOnAxis(axis, pitch);
      this.mesh.rotateOnAxis(new t.Vector3(0, 1, 0), yaw);
      this.mesh.position.copy(position);
      this.mesh.__board = this;
      this.canvas = document.createElement("canvas");
      aspectRatio = this.height * 1.0 / (this.width * 1.0);
      this.canvas.width = 1024;
      this.canvas.height = 1024.0 * aspectRatio;
      true;
    }

    Board.prototype.addToScene = function(scene) {
      scene.add(this.mesh);
      return this.createPointLight(scene);
    };

    Board.prototype.createPointLight = function(scene) {
      var norm, normalMatrix;
      this.light = new t.PointLight(0xFFFFFF, Math.floor(this.width * this.height / 10), 10);
      this.light.position.copy(this.mesh.position);
      scene.add(this.mesh);
      norm = new t.Vector3();
      norm.copy(this.geometry.faces[0].normal);
      this.mesh.updateMatrixWorld();
      normalMatrix = new t.Matrix3();
      normalMatrix.getNormalMatrix(this.mesh.matrixWorld);
      norm.applyMatrix3(normalMatrix);
      norm.multiplyScalar(3);
      this.light.position.add(norm);
      return scene.add(this.light);
    };

    Board.prototype.drawOn = function(f) {
      var ctx;
      ctx = this.canvas.getContext('2d');
      return f(ctx, this.canvas.width, this.canvas.height);
    };

    Board.prototype.refresh = function() {
      var ctx, image, texture;
      ctx = this.canvas.getContext('2d');
      image = new Image();
      ctx.save();
      image.src = this.canvas.toDataURL();
      texture = new t.Texture(image);
      texture.needsUpdate = true;
      return this.material.setValues({
        map: texture
      });
    };

    return Board;

  })();

  window.Board = Board;

}).call(this);
